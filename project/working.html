<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DBMS Notes Viewer + PDF Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: #f5f5f5;
      margin: 0;
    }

    #pages-container {
      max-width: 900px;
      margin: 40px auto;
    }

    .page {
      background: white;
      width: 100%;
      height: 1123px;
      margin: 0 auto 20px auto;
      padding: 40px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      overflow: hidden;
    }

    h1, h2, h3 {
      color: #2c3e50;
    }

    code, pre {
      background-color: #f0f0f0;
      padding: 8px;
      border-radius: 5px;
      display: block;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    table, th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }

    blockquote {
      background: #eef;
      padding: 15px;
      border-left: 5px solid #88f;
      margin: 20px 0;
    }

    /* Floating Button */
    #download-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #007acc;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      z-index: 999;
    }

    #download-btn:hover {
      background: #005f9e;
    }
  </style>
</head>
<body>

  <center><h1>üìò DBMS Notes Viewer</h1></center>

  <div id="pages-container"></div>

  <button id="download-btn" onclick="generatePDF()">‚¨áÔ∏è Download PDF</button>

  <script>
    // ===== Viewer Logic (Paginated Markdown Display) =====
    fetch('Unit1_Database_Management.md')
      .then(res => res.text())
      .then(md => {
        const html = marked.parse(md);
        const temp = document.createElement('div');
        temp.style.position = 'absolute';
        temp.style.visibility = 'hidden';
        temp.style.width = '794px';
        temp.style.padding = '40px';
        temp.innerHTML = html;
        document.body.appendChild(temp);

        const container = document.getElementById('pages-container');
        const elements = [...temp.children];

        let currentPage = createNewPage();
        container.appendChild(currentPage);

        for (let el of elements) {
          const clone = el.cloneNode(true);
          currentPage.appendChild(clone);

          if (currentPage.scrollHeight > currentPage.clientHeight) {
            currentPage.removeChild(clone);
            currentPage = createNewPage();
            currentPage.appendChild(clone);
            container.appendChild(currentPage);
          }
        }

        document.body.removeChild(temp);
      });

    function createNewPage() {
      const page = document.createElement('div');
      page.className = 'page';
      return page;
    }

    // ===== PDF Generation Logic (Separate) =====
        let fetchedMarkdown = '';

    async function generatePDF() {
      if (!fetchedMarkdown) {
        alert("Markdown not loaded.");
        return;
      }

      const markdownHtml = marked.parse(fetchedMarkdown);

      // Cover page HTML
      const cover = document.createElement("div");
      cover.className = "cover-page";
      cover.innerHTML = `
        <h1 style="font-size: 36px;">Database Management System</h1>
        <h3>By Aryan Mungekar</h3>
        <h4>${new Date().toLocaleDateString()}</h4>
      `;

      const content = document.createElement("div");
      content.className = "pdf-content";
      content.innerHTML = markdownHtml;

      const wrapper = document.createElement("div");
      wrapper.appendChild(cover);
      wrapper.appendChild(content);

      html2pdf().set({
        margin: 10,
        filename: 'markdown_with_cover.pdf',
        html2canvas: { scale: 1.4 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak: { mode: ['css', 'avoid-all', 'legacy'] }
      }).from(wrapper).save();
    }

    // üîó Fetch the Markdown file from a URL
    const markdownUrl = 'Unit1_Database_Management.md'; // ‚Üê Replace with your actual file path or URL
    fetch(markdownUrl)
      .then(res => res.text())
      .then(data => {
        fetchedMarkdown = data;
        console.log('Markdown loaded successfully.');
      })
      .catch(err => {
        console.error("Failed to load markdown file:", err);
        alert("Failed to load Markdown file.");
      });
  </script>

</body>
</html>
